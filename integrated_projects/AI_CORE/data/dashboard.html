<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth System Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; color: #00ff00; }
        h2 { color: #0070ba; margin: 30px 0 20px 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: #2a2a2a; padding: 20px; border-radius: 8px; border-left: 4px solid #00ff00; }
        .card h3 { color: #00ff00; margin-bottom: 10px; }
        .card .value { font-size: 24px; font-weight: bold; }
        .card .unit { color: #888; font-size: 12px; }
        .progress-bar { width: 100%; height: 20px; background: #444; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00ff00, #00aa00); transition: width 0.3s; }
        .chart { background: #2a2a2a; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .transactions, .payment-section { background: #2a2a2a; padding: 20px; border-radius: 8px; }
        .payment-section { border-left: 4px solid #0070ba; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #444; }
        th { background: #1a1a1a; color: #00ff00; }
        tr:hover { background: #333; }
        .btn { background: #00ff00; color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn:hover { background: #00aa00; }
        .payment-card { border-left-color: #0070ba; }
        .payment-card h3 { color: #0070ba; }
        .service-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .service-item { background: #1a1a1a; padding: 15px; border-radius: 6px; border: 1px solid #444; }
        .service-name { color: #0070ba; font-weight: bold; margin-bottom: 5px; }
        .service-price { color: #00ff00; font-size: 18px; }
        .paypal-badge { background: #0070ba; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; margin-left: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Autonomous Wealth System Dashboard</h1>
        
        <div class="grid">
            <div class="card">
                <h3>Capital</h3>
                <div class="value" id="capital">0.00</div>
                <div class="unit">CHF</div>
            </div>
            <div class="card">
                <h3>Target</h3>
                <div class="value">10,000.00</div>
                <div class="unit">CHF</div>
            </div>
            <div class="card">
                <h3>Progress</h3>
                <div class="value" id="progress">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            <div class="card">
                <h3>Cycles</h3>
                <div class="value" id="cycles">0</div>
            </div>
            <div class="card">
                <h3>Art Assets</h3>
                <div class="value" id="art">0</div>
            </div>
            <div class="card">
                <h3>Active Clones</h3>
                <div class="value" id="clones">0</div>
            </div>
        </div>

        <!-- PayPal Payment Cards -->
        <h2>ðŸ’³ PayPal Business Integration</h2>
        <div class="grid">
            <div class="card payment-card">
                <h3>PayPal Revenue</h3>
                <div class="value" id="paypal-revenue">$0.00</div>
                <div class="unit">USD <span class="paypal-badge">PAYPAL</span></div>
            </div>
            <div class="card payment-card">
                <h3>Captured Payments</h3>
                <div class="value" id="captured-payments">0</div>
                <div class="unit">successful</div>
            </div>
            <div class="card payment-card">
                <h3>Pending Payments</h3>
                <div class="value" id="pending-payments">0</div>
                <div class="unit">awaiting capture</div>
            </div>
            <div class="card payment-card">
                <h3>Revenue / Cycle</h3>
                <div class="value" id="revenue-per-cycle">$0.00</div>
                <div class="unit">average</div>
            </div>
        </div>

        <div class="chart">
            <h3>Analytics</h3>
            <p>Art Profit: <span id="art-profit">0.00</span> CHF</p>
            <p>Trading Profit: <span id="trading-profit">0.00</span> CHF</p>
            <p>Avg Cycle: <span id="avg-cycle">0.00</span> CHF</p>
            <p style="margin-top: 10px; color: #0070ba;">ðŸ’³ PayPal Revenue: <span id="paypal-analytics-revenue">$0.00</span> USD</p>
            <p style="color: #0070ba;">Total Payments: <span id="paypal-analytics-payments">0</span></p>
        </div>

        <!-- PayPal Services Section -->
        <div class="payment-section">
            <h3>ðŸ’¼ Available PayPal Services</h3>
            <div class="service-list" id="services-list">
                <!-- Services will be populated by JavaScript -->
            </div>
        </div>

        <!-- PayPal Payments Section -->
        <div class="payment-section">
            <h3>ðŸ’³ PayPal Payment Transactions</h3>
            <table id="paypal-payments-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Service</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody id="paypal-payments-body"></tbody>
            </table>
        </div>

        <div class="transactions">
            <h3>Recent Transactions</h3>
            <button class="btn" onclick="executeCycle()">Execute Cycle</button>
            <table id="transactions-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody id="transactions-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';

        async function updateDashboard() {
            try {
                const status = await fetch(`${API_URL}/status`).then(r => r.json());
                document.getElementById('capital').textContent = status.capital.toFixed(2);
                document.getElementById('progress').textContent = status.progress.toFixed(1) + '%';
                document.getElementById('progress-fill').style.width = Math.min(status.progress, 100) + '%';
                document.getElementById('cycles').textContent = status.cycles;
                document.getElementById('art').textContent = status.art_assets;
                document.getElementById('clones').textContent = status.active_clones;

                const analytics = await fetch(`${API_URL}/analytics`).then(r => r.json());
                document.getElementById('art-profit').textContent = analytics.art_profit.toFixed(2);
                document.getElementById('trading-profit').textContent = analytics.trading_profit.toFixed(2);
                document.getElementById('avg-cycle').textContent = analytics.avg_cycle_profit.toFixed(2);

                // Update PayPal analytics if available
                if (analytics.payment_stats) {
                    document.getElementById('paypal-analytics-revenue').textContent = '$' + (analytics.payment_stats.payment_revenue || 0).toFixed(2);
                    document.getElementById('paypal-analytics-payments').textContent = analytics.payment_stats.captured_payments || 0;
                }

                const transactions = await fetch(`${API_URL}/transactions`).then(r => r.json());
                const tbody = document.getElementById('transactions-body');
                tbody.innerHTML = transactions.slice(0, 10).map(t => `
                    <tr>
                        <td>${new Date(t.timestamp).toLocaleString()}</td>
                        <td>${t.type}</td>
                        <td>${t.amount.toFixed(2)}</td>
                        <td>${t.balance.toFixed(2)}</td>
                    </tr>
                `).join('');

                // Update PayPal data
                await updatePayPalData();
            } catch (e) {
                console.error('Error updating dashboard:', e);
            }
        }

        async function updatePayPalData() {
            try {
                // Get PayPal payment statistics
                const paymentStats = await fetch(`${API_URL}/paypal/payment-stats`).then(r => r.json());
                document.getElementById('paypal-revenue').textContent = '$' + (paymentStats.captured_amount || 0).toFixed(2);
                document.getElementById('captured-payments').textContent = paymentStats.captured_payments || 0;
                document.getElementById('pending-payments').textContent = paymentStats.pending_payments || 0;
                
                // Calculate revenue per cycle
                const cycles = document.getElementById('cycles').textContent;
                const revenue = paymentStats.captured_amount || 0;
                const revenuePerCycle = cycles > 0 ? (revenue / cycles) : 0;
                document.getElementById('revenue-per-cycle').textContent = '$' + revenuePerCycle.toFixed(2);

                // Get PayPal payments
                const payments = await fetch(`${API_URL}/paypal/payments`).then(r => r.json());
                const paymentsBody = document.getElementById('paypal-payments-body');
                
                paymentsBody.innerHTML = payments.slice(0, 10).map(p => {
                    const isCaptured = p.status === 'CAPTURED';
                    const bgColor = isCaptured ? 'rgba(0, 255, 0, 0.2)' : 'rgba(255, 170, 0, 0.2)';
                    const textColor = isCaptured ? '#00ff00' : '#ffaa00';
                    
                    return `
                    <tr>
                        <td style="font-family: monospace; font-size: 12px;">${p.order_id}</td>
                        <td>${p.service_type.replace('_', ' ').toUpperCase()}</td>
                        <td>$${p.amount.toFixed(2)} ${p.currency}</td>
                        <td>
                            <span style="padding: 2px 8px; border-radius: 12px; font-size: 10px; 
                                background: ${bgColor}; color: ${textColor};">
                                ${p.status}
                            </span>
                        </td>
                        <td>${new Date(p.created_at).toLocaleString()}</td>
                    </tr>
                    `;
                }).join('');

                // Get available services
                await updatePayPalServices();

            } catch (e) {
                console.error('Error updating PayPal data:', e);
            }
        }

        async function updatePayPalServices() {
            try {
                const services = await fetch(`${API_URL}/paypal/services`).then(r => r.json());
                const servicesList = document.getElementById('services-list');
                
                if (services.services) {
                    servicesList.innerHTML = Object.entries(services.services).map(([key, service]) => `
                        <div class="service-item">
                            <div class="service-name">${service.description || key.replace('_', ' ').toUpperCase()}</div>
                            <div class="service-price">$${service.price_usd.toFixed(2)} ${services.currency}</div>
                            <div style="font-size: 10px; color: #888; margin-top: 5px;">${key}</div>
                        </div>
                    `).join('');
                }
            } catch (e) {
                console.error('Error updating PayPal services:', e);
            }
        }

        async function executeCycle() {
            try {
                const result = await fetch(`${API_URL}/cycle`, { method: 'POST' }).then(r => r.json());
                alert(`Cycle executed! Profit: ${result.profit.toFixed(2)} CHF`);
                updateDashboard();
            } catch (e) {
                alert('Error executing cycle: ' + e);
            }
        }

        // Initialize dashboard
        updateDashboard();
        setInterval(updateDashboard, 5000);
    </script>
</body>
</html>
